#!/usr/bin/env nu

export def main [line: string] {
  let clean_line = ($line | ansi strip)
  let extracted = ($clean_line | parse --regex '\b(?P<sha>[0-9a-fA-F]{7,40})\b' | get 0.sha)

  if ($extracted | is-empty) {
    print "No commit selected."
    return
  }

  let sha = $extracted
  let has_delta = (which delta | is-not-empty)

  with-env { GIT_PAGER_IN_USE: "true" } {
    git show --color=always -U3 $sha | if $has_delta { delta --paging=never } else { cat }
  }
}
