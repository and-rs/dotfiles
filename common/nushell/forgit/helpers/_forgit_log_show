#!/usr/bin/env nu

export def main [line: string] {
  let clean_line = ($line | ansi strip)
  let sha = ($clean_line | parse --regex '\b(?P<sha>[0-9a-fA-F]{7,40})\b' | get 0?.sha? | default "")

  if ($sha | is-empty) {
    return
  }

  with-env {
    GIT_PAGER_IN_USE: "true"
    LESS: "-R -c -+X -+F"
  } {
    git show --color=always $sha
    | if (which delta | is-not-empty) { delta --paging always } else { less -R }
  }
}
